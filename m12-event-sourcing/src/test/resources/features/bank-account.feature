Feature: 銀行帳戶事件溯源

  Scenario: 開戶並存入資金
    When 開立帳戶 "ACC-001" 持有人 "王小明" 初始餘額 10000 元
    And 存入 5000 元到帳戶 "ACC-001"
    Then 帳戶 "ACC-001" 餘額為 15000 元
    And 帳戶 "ACC-001" 事件數量為 2

  Scenario: 從事件重播重建帳戶狀態
    Given 帳戶 "ACC-002" 依序發生以下事件
      | 事件類型 | 金額  |
      | 開戶     | 50000 |
      | 存款     | 20000 |
      | 提款     | 10000 |
      | 轉帳     | 5000  |
    When 從事件重播帳戶 "ACC-002"
    Then 帳戶 "ACC-002" 餘額為 55000 元
    And 帳戶 "ACC-002" 版本號為 4

  Scenario: 餘額不足提款失敗
    Given 已開立帳戶 "ACC-003" 初始餘額 10000 元
    When 嘗試從帳戶 "ACC-003" 提款 20000 元
    Then 操作失敗並回傳餘額不足錯誤

  Scenario: 快照機制加速帳戶載入
    Given 已開立帳戶 "ACC-004" 初始餘額 10000 元
    And 連續存入 4 筆 1000 元到帳戶 "ACC-004"
    Then 帳戶 "ACC-004" 產生快照於版本 5
    When 再存入 2000 元到帳戶 "ACC-004"
    Then 帳戶 "ACC-004" 餘額為 16000 元
